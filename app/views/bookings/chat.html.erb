<!-- filepath: /home/mic/code/Mikke777/inspirationgathered/app/views/bookings/chat.html.erb -->
<div class="container">
  <div class="row">
    <div class="col-md-10 mx-auto">
      <div class="chat">
        <h1>Chat with <%= @other_user.name %> about <%= @booking.workshop.title %></h1>
        <%= turbo_stream_from "booking_#{@booking.id}_messages" %>
        <div id="messages" class="messages">
          <% @messages.each do |message| %>
            <%= render "messages/message", message: message, user: current_user %>
          <% end %>
        </div>

        <%= simple_form_for [@booking, Message.new], url: workshop_booking_messages_path(@booking.workshop, @booking), html: { class: "d-flex align-items-center" }, data: { turbo_stream: true, controller: "reset-form", action: "turbo:submit-end->reset-form#reset" } do |f| %>
          <% other_user = current_user == @booking.workshop.user ? @booking.user : @booking.workshop.user %>
          <%= f.input :content, label: false, placeholder: "Message #{other_user.name}", wrapper_html: { class: "flex-grow-1 mb-0" }, input_html: { class: "form-control" } %>
          <%= f.submit "Send", class: "btn btn-primary mb-3 py-3" %>
        <% end %>
      </div>
    </div>
  </div>
</div>
